import{hasTouch,nextFrame,setIntersectionObserverItems}from"./utils.min.js";export function setScroller(e){const t=e.querySelectorAll(".slide");setIntersectionObserverItems({elements:t,callbackIn:e=>{e.target.classList.add("is-visible");const t=new CustomEvent("show",{detail:e.target,bubbles:!0});e.target.dispatchEvent(t)},callbackOut:e=>{e.target.classList.remove("is-visible");const t=new CustomEvent("hide",{detail:e.target,bubbles:!0});e.target.dispatchEvent(t)},dontUnobserve:!0,rootMargin:"0px",threshold:.8});const s=document.getElementById("btnPrev")||e.querySelector(".btn-prev"),l=document.getElementById("btnNext")||e.querySelector(".btn-prev");new ResizeObserver((t=>{checkScroller(e,s,l)})).observe(e),e.addEventListener("scrollend",(()=>{e.classList.remove("scrolling"),checkScroller(e,s,l)})),e.addEventListener("scroll",(()=>{e.classList.add("scrolling")}),{passive:!0}),s&&s.addEventListener("click",(t=>{if(e.classList.contains("scrolling"))return!1;t.stopPropagation();const l=e.querySelector(".slide.is-visible"),r=l?l.previousElementSibling:null;r?r.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"}):(e.scrollLeft=0,s.setAttribute("disabled",!0))})),l&&l.addEventListener("click",(s=>{if(e.classList.contains("scrolling"))return!1;s.stopPropagation();const r=e.querySelectorAll(".slide.is-visible"),i=r?r[r.length-1]:null,o=i?i.nextElementSibling:null;o||Array.prototype.indexOf.call(t,o)>t.length?o.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"}):(e.scrollLeft=e.scrollWidth,l.setAttribute("disabled",!0))})),setDesktopScroller(e),loadScrollendPolyfill(e)}const checkScroller=function(e,t,s,l,r){const i=e.classList.contains("scrolled-left"),o=e.classList.contains("scrolled-right"),n=t||e.querySelector(".btn-prev"),c=s||e.querySelector(".btn-next");nextFrame((()=>{e.classList.toggle("scrolled-left",e.scrollLeft>5),e.classList.toggle("scrolled-right",Math.ceil(e.scrollLeft)<e.scrollWidth-e.offsetWidth-1);const t=e.classList.contains("scrolled-left"),s=e.classList.contains("scrolled-right");!r||t===i&&s===o||r(t,s,e),n&&(e.classList.contains("scrolled-left")?n.removeAttribute("disabled"):n.setAttribute("disabled",!0)),c&&(e.classList.contains("scrolled-right")?c.removeAttribute("disabled"):c.setAttribute("disabled",!0)),l&&l(t,s,e)}))},setDesktopScroller=function(e){if(hasTouch())return!1;const t=e;let s,l,r,i=!1,o=!1,n=0;t.addEventListener("wheel",(s=>{let l=s.target;if((l.classList.contains("scrollable")||l.closest(".scrollable"))&&(l=l.classList.contains("scrollable")?l:l.closest(".scrollable"),l.scrollHeight>l.clientHeight)){if(!(l.scrollTop>=l.scrollHeight-l.offsetHeight-1||0===l.scrollTop))return n=0,!0;if(n+=1,!(n>5))return!0;n=0}n=0,nextFrame((()=>{t.scrollLeft+=s.deltaX?s.deltaX:s.deltaY,e.classList.add("wheeling"),clearTimeout(r),r=setTimeout((()=>e.classList.remove("wheeling")),200)}))}),{passive:!0}),t.addEventListener("click",(e=>{o&&(e.preventDefault(),e.stopPropagation())}),!0),t.addEventListener("mousedown",(e=>{i=!0,o=!1,t.classList.add("dragging"),s=e.pageX-t.offsetLeft,l=t.scrollLeft}),{passive:!0}),t.addEventListener("mouseup",(e=>{i=!1,t.classList.remove("dragging")}),{passive:!1}),t.addEventListener("mouseleave",(()=>{i=!1,t.classList.remove("dragging")})),t.addEventListener("mousemove",(e=>{if(!i||!e.buttons)return;const r=4*(e.pageX-t.offsetLeft-s);Math.abs(r)>5&&(o=!0),nextFrame((()=>{t.scrollLeft=l-r}))}),{passive:!1}),t.addEventListener("dragstart",(e=>{(e.target.classList.contains("drag-item")?e.target:e.target.closest(".drag-item"))||e.dataTransfer.setDragImage(t,-99999,-99999)}),{passive:!0}),t.classList.add("swipeable")};async function loadScrollendPolyfill(e){"onscrollend"in window||(await import("./polyfills/scrollend.polyfill.min.js"),e.classList.add("scrollend-polyfilled"))}