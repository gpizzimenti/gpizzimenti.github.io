import{debounce,hasTouch,nextFrame,setIntersectionObserverItems}from"./utils.min.js";export function setScroller(e){const t=e.querySelectorAll(".slide");let s;setIntersectionObserverItems({elements:t,callbackIn:e=>{e.target.classList.add("is-visible");const t=new CustomEvent("show",{detail:e.target,bubbles:!0});e.target.dispatchEvent(t)},callbackOut:e=>{e.target.classList.remove("is-visible");const t=new CustomEvent("hide",{detail:e.target,bubbles:!0});e.target.dispatchEvent(t)},dontUnobserve:!0,rootMargin:"0px",threshold:.5});const l=document.getElementById("btnPrev")||e.querySelector(".btn-prev"),r=document.getElementById("btnNext")||e.querySelector(".btn-prev"),i=debounce((()=>checkScroller(e,l,r)),50);new ResizeObserver((e=>{i()})).observe(e),e.addEventListener("scroll",(()=>{e.classList.add("scrolling"),clearTimeout(s),s=setTimeout((()=>{e.classList.remove("scrolling");const t=new CustomEvent("scrollStop",{detail:e});e.dispatchEvent(t)}),100),i()}),{passive:!0}),l&&l.addEventListener("click",(t=>{if(e.classList.contains("scrolling"))return!1;t.stopPropagation();const s=e.querySelector(".slide.is-visible"),r=s?s.previousElementSibling:null;r?r.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}):(e.scrollLeft=0,l.setAttribute("disabled",!0))})),r&&r.addEventListener("click",(s=>{if(e.classList.contains("scrolling"))return!1;s.stopPropagation();const l=e.querySelectorAll(".slide.is-visible"),i=l?l[l.length-1]:null,o=i?i.nextElementSibling:null;o||Array.prototype.indexOf.call(t,o)>t.length?o.scrollIntoView({behavior:"smooth",block:"nearest",inline:"end"}):(e.scrollLeft=e.scrollWidth,r.setAttribute("disabled",!0))})),setDesktopScroller(e)}const checkScroller=function(e,t,s,l,r){const i=e.classList.contains("scrolled-left"),o=e.classList.contains("scrolled-right"),n=t||e.querySelector(".btn-prev"),a=s||e.querySelector(".btn-next");nextFrame((()=>{e.classList.toggle("scrolled-left",e.scrollLeft>5),e.classList.toggle("scrolled-right",Math.ceil(e.scrollLeft)<e.scrollWidth-e.offsetWidth-1);const t=e.classList.contains("scrolled-left"),s=e.classList.contains("scrolled-right");!r||t===i&&s===o||r(t,s,e),n&&(e.classList.contains("scrolled-left")?n.removeAttribute("disabled"):n.setAttribute("disabled",!0)),a&&(e.classList.contains("scrolled-right")?a.removeAttribute("disabled"):a.setAttribute("disabled",!0)),l&&l(t,s,e)}))},setDesktopScroller=function(e){if(hasTouch())return!1;const t=e;let s,l,r,i,o=!1,n=[0,0],a=(new Date).getTime(),c=0;t.addEventListener("wheel",(s=>{let l=s.target;if((l.classList.contains("scrollable")||l.closest(".scrollable"))&&(l=l.classList.contains("scrollable")?l:l.closest(".scrollable"),l.scrollHeight>l.clientHeight)){if(!(l.scrollTop>=l.scrollHeight-l.offsetHeight-1||0===l.scrollTop))return c=0,!0;if(c+=1,!(c>5))return!0;c=0}c=0,nextFrame((()=>{t.scrollLeft+=s.deltaX?s.deltaX:s.deltaY,e.classList.add("wheeling"),clearTimeout(i),i=setTimeout((()=>e.classList.remove("wheeling")),200)}))}),{passive:!0}),t.querySelectorAll("a").forEach((e=>{e.addEventListener("mousedown",(e=>{e.preventDefault()}),{passive:!1})})),t.addEventListener("mousedown",(e=>{o=!0,t.classList.add("dragging"),s=e.pageX-t.offsetLeft,l=t.scrollLeft,n=[e.pageX,e.pageY,t.scrollLeft],a=(new Date).getTime()}),{passive:!0}),t.addEventListener("mouseup",(e=>{if(o=!1,r=(new Date).getTime(),t.classList.remove("dragging"),r-a<500&&e.pageX===n[0]&&e.pageY===n[1]&&t.scrollLeft===n[2])return!0;e.preventDefault(),e.stopImmediatePropagation()}),{passive:!1}),t.addEventListener("mouseleave",(()=>{o=!1,t.classList.remove("dragging")})),t.addEventListener("mousemove",(e=>{if(!o)return;const r=4*(e.pageX-t.offsetLeft-s);nextFrame((()=>{t.scrollLeft=l-r}))}),{passive:!1}),t.addEventListener("dragstart",(e=>{(e.target.classList.contains("drag-item")?e.target:e.target.closest(".drag-item"))||e.dataTransfer.setDragImage(t,-99999,-99999)}),{passive:!0}),t.classList.add("swipeable")};