import{HexToHSL,invertColor}from"./lib/colors.min.js";import{setScroller}from"./lib/scrollableList.min.js";import{debounce,englishOrdinalSuffix,fetchResource,hasTouch,html,isScrollable,nextFrame,setIntersectionObserverItems,softExec}from"./lib/utils.min.js";const context={domain:"giuseppe.pizzimenti.dev",languages:["it","en"]};context.labels={it:{downloadStarted:"Download avviato",error:"Si è verificato un errore",errorLoading:"Errore nel caricamento",loading:"Caricamento in corso",messageSent:"Messaggio inviato",offline:"Connessione assente",offlineTryLater:"Connessione assente, prova più tardi",online:"Sei di nuovo online",sceglisezioni:"Scegli le sezioni da includere e trascinale per riordinarle",nrtrovati:(e,t)=>0===e?"Nessun risultato":1===e?"<b>1</b> risultato":`<b>${t}</b><sup>&#176;</sup> di <b>${e}</b> risultati`,title:"Giuseppe Pizzimenti - Software Developer"},en:{downloadStarted:"Download started",error:"An error occurred",errorLoading:"Network error",loading:"Loading",messageSent:"Message sent",offline:"Connection lost",offlineTryLater:"Connection lost, try later",online:"You are online again",sceglisezioni:"Choose the sections to include and drag to reorder",nrtrovati:(e,t)=>0===e?"No results":1===e?"<b>1</b> result":`<b>${t}</b><sup>${englishOrdinalSuffix(t)}</sup> of <b>${e}</b> results`,title:"Giuseppe Pizzimenti - Software Developer"}},context.dynaContent={datalists:{it:{corsi:{name:"corsi",ready:!1},eventi_partecipante:{name:"eventi_partecipante",ready:!1},eventi_relatore:{name:"eventi_relatore",ready:!1}},en:{corsi:{name:"corsi",ready:!1},eventi_partecipante:{name:"eventi_partecipante",ready:!1},eventi_relatore:{name:"eventi_relatore",ready:!1}}},slides:{it:{chisono:{name:"chisono",title:"Chi sono",ready:!1},profili:{name:"profili",title:"Profili",ready:!1},esperienza:{name:"esperienza",title:"Esperienza",ready:!1},skills:{name:"skills",title:"Competenze tecniche",ready:!1},formazione:{name:"formazione",title:"Studi e Formazione",ready:!1},eventi:{name:"eventi",title:"Eventi",ready:!1},associazioni:{name:"associazioni",title:"Associazioni",ready:!1},pubblicazioni:{name:"pubblicazioni",title:"Pubblicazioni",ready:!1},progetti:{name:"progetti",title:"Progetti personali",ready:!1},cv:{name:"cv",title:"Curriculum vitae",ready:!1},contattami:{name:"contattami",title:"Contattami",ready:!1}},en:{chisono:{name:"chisono",title:"About me",ready:!1},profili:{name:"profili",title:"Profiles",ready:!1},esperienza:{name:"esperienza",title:"Experience",ready:!1},skills:{name:"skills",title:"Technical skills",ready:!1},formazione:{name:"formazione",title:"Education & Courses",ready:!1},eventi:{name:"eventi",title:"Events",ready:!1},associazioni:{name:"associazioni",title:"Associations",ready:!1},pubblicazioni:{name:"pubblicazioni",title:"Publications",ready:!1},progetti:{name:"progetti",title:"Personal projects",ready:!1},cv:{name:"cv",title:"Resume",ready:!1},contattami:{name:"contattami",title:"Contact me",ready:!1}}}};const config={urls:{modules:{cv:"./cv.min.js",contactme:"./contactForm.min.js"},libs:{dayjs:"./lib/dayjs/1.11.7/dayjs.min.js",markjs:"./lib/markjs/9.0.0/mark.es6.min.js",jspdf:"./scripts/lib/jsPDF/2.5.1/jspdf-2.5.1.umd.min.js",dompurify:"./scripts/lib/domPurify/3.0.6/dompurify.min.js",draggablelistjs:"./lib/draggableList.min.js",notificationsjs:"./lib/notifications.min.js",swiperjs:"./lib/swiper.min.js"},datalists:{corsi:["../data/corsi/2024.min.json","../data/corsi/2023.min.json","../data/corsi/2022.min.json","../data/corsi/2020.min.json","../data/corsi/2018.min.json","../data/corsi/2016.min.json","../data/corsi/2013.min.json","../data/corsi/2008.min.json","../data/corsi/2005.min.json","../data/corsi/2004.min.json","../data/corsi/1998.min.json"],eventi_partecipante:["../data/eventi/partecipante.min.json","../data/eventi/codemotion/codemotion_gmail1_1.min.json","../data/eventi/codemotion/codemotion_gmail1_2.min.json","../data/eventi/codemotion/codemotion_gmail1_3.min.json","../data/eventi/eventbrite/eventbrite_gmail1.min.json","../data/eventi/eventbrite/eventbrite_gmail2.min.json","../data/eventi/google/giuseppe.pizzimenti.seed@gmail.com.min.json"],eventi_relatore:["../data/eventi/relatore.min.json"]},workers:{db:"./scripts/data.worker.min.js"},schema:"./schema.min.json",include:(e,t)=>`./includes/${e}/${t}.inc.min.html`}},setup=function(){softExec(setUI),softExec(setState),softExec(setEvents),softExec(setDataWorker),softExec((()=>setScroller(context.elementsCache.scrollingContainer))),softExec(setMenu),softExec(setSearch);const e=location.hash?location.hash.substring(1):"chisono";setTimeout((()=>softExec((()=>navigate(e)))),200),softExec((()=>fetchResource(config.urls.schema,"jsonld","schema")))},setUI=function(){context.elementsCache={colorPicker:document.getElementById("color"),languageSwitcher:document.getElementById("language"),scrollingContainer:document.querySelector("main"),sectionsMenu:document.getElementById("sectionsMenu")};const e=context.elementsCache.scrollingContainer.querySelectorAll("section[data-sezione]");setIntersectionObserverItems({elements:e,callbackIn:e=>{executeWhenNotScrolling((()=>setSlide(e.target)))},rootMargin:"0px",threshold:.2}),document.body.classList.add("loaded")},setSlide=function(e){const t=e.getAttribute("lang"),n={name:e.dataset.sezione,lang:t,error:null,slide:e},a=()=>{const e=new CustomEvent("slideRendered",{detail:n});context.elementsCache.scrollingContainer.dispatchEvent(e)};return new Promise(((s,o)=>{if(e.classList.contains("rendered"))s();else{const s=e.querySelector("article");e.classList.add("loading"),html(s,`<p class="loadingText>${context.labels[context.state.lang].loading}</p>`),fetch(config.urls.include(t,e.dataset.sezione)).then((e=>e.text())).then((n=>{executeWhenNotScrolling((()=>renderSlide(s,n,t).then((()=>{e.classList.remove("loading"),e.classList.add("rendered"),a()}))))})).catch((t=>{html(s,`<p class="errorText">${context.labels[context.state.lang].errorLoading}</p>`),e.classList.add("error"),n.error=t,a(),o(t)}))}}))},renderSlide=async function(e,t,n){if(html(e,t),e.querySelectorAll("details:not(.togglerSet)").forEach((e=>setDetails(e))),e.querySelectorAll("[data-dblist]").forEach((e=>{context.workers.db.postMessage({action:"renderDataList",name:e.dataset.dblist,lang:n,datasources:config.urls.datalists[e.dataset.dblist]})})),e.querySelector("[data-datestart]"))return setDates(e)},setState=function(){context.state=localStorage.getItem(context.domain)?JSON.parse(localStorage.getItem(context.domain)):{lang:"it"},context.state.lang&&(setLang(context.state.lang),context.elementsCache.languageSwitcher.querySelector(`[value='${context.state.lang}']`).checked=!0),context.state.baseColor&&(setBGColor(context.state.baseColor),context.elementsCache.colorPicker.value=context.state.baseColor)},setEvents=function(){context.elementsCache.colorPicker.addEventListener("input",(()=>setBGColor(context.elementsCache.colorPicker.value)),!1),context.elementsCache.languageSwitcher.addEventListener("click",(e=>e.stopPropagation())),context.elementsCache.languageSwitcher.addEventListener("change",(()=>setLang(context.elementsCache.languageSwitcher.querySelector(":checked").value)),!1),context.elementsCache.scrollingContainer.addEventListener("change",(e=>{const t=e.target;t?.classList.contains("chkMaximize")&&toggleMaximizeSlide(t.closest(".slide"),t.checked)}),!1),context.elementsCache.scrollingContainer.querySelectorAll(".slide").forEach((e=>e.addEventListener("mouseenter",(t=>{const n=context.elementsCache.scrollingContainer.querySelector(".expanded");n?.id!==e.id&&n?.classList.remove("expanded")}),!1))),document.addEventListener("keydown",(e=>{"Escape"===e.key&&toggleMaximizeSlide(context.elementsCache.scrollingContainer.querySelector(".slide.maximized"),!1)})),context.elementsCache.scrollingContainer.addEventListener("datalistRendered",(e=>{logLoadedEvent("datalistRendered",e.detail)})),context.elementsCache.scrollingContainer.addEventListener("slideRendered",(e=>{logLoadedEvent("slideRendered",e.detail),"cv"===e.detail.name&&setCV(e.detail.slide)})),context.elementsCache.scrollingContainer.addEventListener("submit",(e=>{e.preventDefault();const t=e.target;switch(t?.dataset?.rel){case"cv":downloadCV();break;case"contattami":sendMsg(t);break;default:break}})),window.addEventListener("hashchange",navigate),window.addEventListener("popstate",(e=>{const t=context.elementsCache.scrollingContainer.querySelector(".maximized");t&&toggleMaximizeSlide(t,!1),e.state?.scrollLeft?(document.title=context.labels[context.state.lang].title,context.elementsCache.scrollingContainer.scrollLeft=e.state.scrollLeft):navigate()}));const e=hasTouch()&&import(config.urls.libs.swiperjs);e&&e.then((e=>{e.setSwiper({element:context.elementsCache.scrollingContainer,onSwipeRight:e=>handleSwipe(e.target,"R"),onSwipeLeft:e=>handleSwipe(e.target,"L")})})),window.addEventListener("offline",(()=>{notify(context.labels[context.state.lang].offline,"warning")})),window.addEventListener("online",(()=>{notify(context.labels[context.state.lang].online,"info")}))},handleSwipe=function(e,t){const n=e.classList.contains("scrollable")?e:e.closest(".scrollable");if(!n||!isScrollable(n).vertical)return!0;{const e=n.closest("li[data-sezione]"),a=Number.parseInt(e.dataset.index),s=n.querySelectorAll("li[data-sezione]");if(1===a&&"R"===t||a===s.length&&"L"===t)return!0;setActiveSectionByIndex(a+("R"===t?-1:1))}},logLoadedEvent=function(e,t){const n=`${e.replace("Rendered","")}s`;context.dynaContent[n][t.lang][t.name].ready=!0,isAllDynaContentLoaded(t.lang)&&(()=>{const e=new CustomEvent("allDynaContentLoaded",{detail:t.lang});context.elementsCache.scrollingContainer.dispatchEvent(e)})()},isAllDynaContentLoaded=function(e){const t=e||context.state.lang;let n=!0;return Object.keys(context.dynaContent).forEach((e=>{n&&(n=!Object.values(context.dynaContent[e][t]).find((e=>!e.ready)))})),n},loadAllDynaContent=function(e){const t=e||context.state.lang;return new Promise((e=>{if(isAllDynaContentLoaded(context.state.lang))e();else{context.elementsCache.scrollingContainer.addEventListener("allDynaContentLoaded",(()=>{e()}));Object.values(context.dynaContent.slides[t]).filter((e=>!e.ready)).forEach((e=>{const n=context.elementsCache.scrollingContainer.querySelector(`section[data-sezione='${e.name}'][lang='${t}']`);setSlide(n)}))}}))},setDataWorker=function(){context.workers=context.workers||{},context.workers.db=new Worker(config.urls.workers.db,{type:"module"}),context.workers.db.onmessage=e=>{if("renderDataList"===e.data.request.action){const t=e.data.request.name,n=e.data.request.lang;executeWhenNotScrolling((()=>renderDataList(t,e.data.result?e.data.html:"",n)))}}},setDetails=function(e){if(e.classList.contains("togglerSet"))return!1;e.addEventListener("toggle",(()=>{e.open&&setTimeout((()=>{e.closest(".scrollable").scroll({top:e.offsetTop,behavior:"smooth"})}),200)})),e.querySelector("summary").dataset.count=e.querySelectorAll("li").length,e.classList.add("togglerSet")},setBGColor=function(e){const t=HexToHSL(e);context.state.baseColor=e,context.state.invertedColor=invertColor(e),persistState(),document.documentElement.style.setProperty("--base-color-H",t[0]),document.documentElement.style.setProperty("--base-color-S",`${t[1]}%`),document.documentElement.style.setProperty("--base-color-L",`${t[2]}%`),document.documentElement.style.setProperty("--inverted-color",context.state.invertedColor)},setLang=function(e){document.querySelector("html").setAttribute("lang",e),document.querySelectorAll("[lang]").forEach((t=>{t.getAttribute("lang")===e?(t.dataset.tabindex&&t.setAttribute("tabindex",t.dataset.tabindex),t.removeAttribute("aria-hidden"),t.removeAttribute("hidden"),t.removeAttribute("disabled"),t.removeAttribute("inert")):(t.hasAttribute("tabindex")&&(t.dataset.tabindex=t.getAttribute("tabindex")),t.removeAttribute("tabindex"),t.setAttribute("aria-hidden",!0),t.toggleAttribute("hidden",!0),t.toggleAttribute("disabled",!0),t.toggleAttribute("inert",!0))})),context.state.lang=e,persistState(),resetSearch()},persistState=function(){localStorage.setItem(context.domain,JSON.stringify(context.state))},setDates=function(e){return import(config.urls.libs.dayjs).then((()=>softExec((()=>{e.querySelectorAll("[data-datestart]").forEach((e=>{const t=e.getAttribute("lang"),n=(e.getAttribute("data-dateend")?dayjs(e.getAttribute("data-dateend")):dayjs(new Date)).diff(e.getAttribute("data-datestart"),"month"),a=Math.floor(n/12);html(e,formatDate(a,n%12>0?n-12*a+1:0,t))}))}))))},formatDate=function(e,t,n){const a=e=>1===e?"en"===n?"1 year":"1 anno":e>1?"en"===n?`${e} years`:`${e} anni`:"";return((e,t)=>{const s=a(12===t?e+1:e),o=t<12?(e=>1===e?"en"===n?"1 month":"1 mese":e>1?"en"===n?`${e} months`:`${e} mesi`:"")(t):"";return`${s.length>0?s:""}${o.length>0?(s.length>0?", ":"")+o:""}`})(e,t)},setMenu=function(){const e=context.elementsCache.sectionsMenu,t=document.getElementById("btnMenu"),n=e.querySelector("menu"),a=context.elementsCache.scrollingContainer,s=t=>{void 0!==t?e.toggleAttribute("open",t):e.toggleAttribute("open"),executeWhenNotAnimating(e,(()=>{n.setAttribute("aria-expanded",e.hasAttribute("open")),e.setAttribute("tabindex",e.hasAttribute("open")?"0":"-1"),e.setAttribute("aria-hidden",!e.hasAttribute("open")),e.toggleAttribute("hidden",!e.hasAttribute("open")),e.toggleAttribute("inert",!e.hasAttribute("open"))})),e.hasAttribute("open")?(n.focus(),setTimeout((()=>document.body.addEventListener("click",(()=>{s(!1)}),{once:!0})),200)):resetSearch()};let o="";context.languages.forEach((e=>{let t=1;Object.entries(context.dynaContent.slides[e]).forEach((n=>{const[a,s]=n,i=`<li role="menuitem" data-sezione="${(r={id:a,index:t,lang:e,hidden:e!==context.state.lang?' hidden inert aria-hidden="true"':"",tabindex:e!==context.state.lang?' data-tabindex="0"':' tabindex="0"',class:"",caption:s.title}).id}" data-index="${r.index}" class="${r.class}" lang="${r.lang}"${r.hidden}><a href="#${r.id}"${r.tabindex}>${r.caption}</a></li>`;var r;o+=i,t+=1}))})),html(n,o),t.addEventListener("click",(e=>{e.stopPropagation(),s()})),e.addEventListener("click",(e=>{e.stopPropagation()})),n.addEventListener("click",(e=>{const t=e.target;if("A"===t.nodeName){e.stopPropagation(),e.preventDefault();const n=t.getAttribute("href").substring(1);context.elementsCache.scrollingContainer.classList.add("activating"),navigate(n).then((()=>executeWhenNotScrolling((()=>setHash(t.getAttribute("href").substring(1))))))}})),a.addEventListener("show",(t=>{const n=t.detail;e.querySelectorAll(`li[data-sezione="${n.getAttribute("data-sezione")}"]`).forEach((e=>e.classList.add("is-visible")))})),a.addEventListener("hide",(t=>{const n=t.detail;e.querySelectorAll(`li[data-sezione="${n.getAttribute("data-sezione")}"]`).forEach((e=>e.classList.remove("is-visible")))}))},setActiveSectionByIndex=function(e){const t=context.elementsCache.scrollingContainer.querySelector(`li[data-index="${e}"]`);if(t)return setActiveSection(t.dataset.sezione)},setActiveSection=function(e){return new Promise((t=>{const n=context.elementsCache.scrollingContainer,a=n.querySelector("li.expanded[data-sezione]"),s=n.querySelector(`li[data-sezione="${e}"]`);if(!s)return!1;const o=100*(Math.abs(s.dataset.index-(a?a.dataset.index:1))+1);softExec((()=>{const i=context.elementsCache.scrollingContainer.querySelector(".maximized");i&&toggleMaximizeSlide(i,!1),s.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"}),executeWhenNotScrolling((()=>{"contattami"===e&&setTimeout((()=>{n.scrollLeft=n.scrollWidth}),250),setTimeout((()=>{executeWhenNotScrolling((()=>{nextFrame((()=>{a&&a.classList.remove("expanded"),s.classList.add("expanded")}))})),document.title=`${context.dynaContent.slides[context.state.lang][e].title} | ${context.labels[context.state.lang].title}`;const o=new CustomEvent("sectionActivated",{detail:s});n.dispatchEvent(o),setTimeout((()=>{n.classList.remove("activating"),s.addEventListener("hide",(()=>{location.hash!==`#${e}`||n.classList.contains("activating")||resetHash()}),{once:!0}),n.addEventListener("scroll",(()=>{nextFrame((()=>{s.classList.remove("expanded")}))}),{once:!0}),t()}),500)}),o)}))}))}))},setHash=function(e){context.elementsCache.scrollingContainer.querySelector(`li[data-sezione="${e}"]`)&&`#${e}`!==location.hash&&(document.title=`${context.dynaContent.slides[context.state.lang][e].title} | ${context.labels[context.state.lang].title}`,history.pushState("","",`${location.pathname}${location.search}#${e}`))},resetHash=function(){location.hash&&(history.pushState("","",`${location.pathname}${location.search}${location.hash}`),history.replaceState({scrollLeft:context.elementsCache.scrollingContainer.scrollLeft},"",`${location.pathname}${location.search}`),document.title=context.labels[context.state.lang].title)},navigate=function(e){const t=e||(location.hash?location.hash.substring(1).toLowerCase():null);if(t&&context.elementsCache.scrollingContainer.querySelector(`li[data-sezione="${t}"]`))return setActiveSection(t)},renderDataList=function(e,t,n){const a={name:e,lang:n,error:null},s=context.elementsCache.scrollingContainer.querySelector(`[data-dblist='${e}'][lang='${n}']`);s.querySelector(".loadingText").remove(),html(s,t,!0),"DETAILS"!==s.nodeName||s.classList.contains("togglerSet")?s.closest("details:not(.togglerSet)")?setDetails(s.closest("details:not(.togglerSet)")):s.querySelectorAll("details:not(.togglerSet)").forEach((e=>setDetails(e))):setDetails(s),s.classList.add("rendered"),(()=>{const e=new CustomEvent("datalistRendered",{detail:a});context.elementsCache.scrollingContainer.dispatchEvent(e)})()},setSearch=function(){const e=context.elementsCache.sectionsMenu;e.querySelectorAll("[type='search']").forEach((t=>{const n=t.closest("search"),a=debounce((()=>search(t.value)),400);t.addEventListener("keyup",(e=>{e.stopPropagation(),e.preventDefault(),"Escape"===e.key&&resetSearch()})),t.addEventListener("keypress",(e=>{(n.classList.contains("searching")||n.classList.contains("indexing"))&&(e.stopPropagation(),e.preventDefault())})),t.addEventListener("input",(t=>{if(n.classList.contains("searching")||n.classList.contains("indexing"))return t.stopPropagation(),t.preventDefault(),!1;e.classList.contains("searchActive")?a():setSearchActive().then(a)})),n.addEventListener("click",(e=>{const t=e.target;(t.classList.contains("clearResults")||t.classList.contains("prevResult")||t.classList.contains("nextResult"))&&(e.stopPropagation(),e.preventDefault(),t.classList.contains("clearResults")?softExec(resetSearch,1e3):t.classList.contains("prevResult")?softExec((()=>goToResult("prev")),1e3):t.classList.contains("nextResult")&&softExec((()=>goToResult("next")),1e3))}))}))},setSearchActive=function(){context.elementsCache.scrollingContainer.classList.add("searchActive");const e=context.elementsCache.sectionsMenu,t=e.querySelector(`search[lang='${context.state.lang}']`).querySelector(".searchControls"),n=document.querySelector(`section[lang='${context.state.lang}']  .togglerPastSkills`),a=a=>(t.toggleAttribute("disabled",!1),t.toggleAttribute("hidden",!1),t.toggleAttribute("inert",!1),t.toggleAttribute("aria-hidden",!1),n.dataset.prevstate=n.checked,n.checked=!0,t.querySelectorAll("a").forEach((e=>e.setAttribute("tabindex",0))),e.classList.add("searchActive"),a());return new Promise((e=>{context.search?.[context.state.lang]?a(e):setSearchEngine().then(a(e))}))},setSearchEngine=function(){const e=context.elementsCache.sectionsMenu.querySelector(`search[lang='${context.state.lang}']`);context.search=context.search||{};const t=(t,n)=>{import(config.urls.libs.markjs).then((()=>{context.search[t]=context.search[t]||{instance:new Mark(context.elementsCache.scrollingContainer.querySelectorAll(`section[data-sezione][lang="${t}"]`)),results:[],cursor:0},e.classList.remove("indexing"),n()}))};return e.classList.add("indexing"),new Promise((e=>{isAllDynaContentLoaded(context.state.lang)?softExec((()=>t(context.state.lang,e))):softExec((()=>loadAllDynaContent(context.state.lang).then(softExec((()=>t(context.state.lang,e))))))}))},resetSearch=function(){const e=context.elementsCache.sectionsMenu,t=e.querySelector(`search[lang='${context.state.lang}']`),n=t.querySelector("[type='search']"),a=t.querySelector(".searchControls"),s=t.querySelector("label"),o=document.querySelector(`section[lang='${context.state.lang}']  .togglerPastSkills`);context.elementsCache.scrollingContainer.classList.remove("searchActive"),o.checked="false"!==o.dataset.prevstate,a.toggleAttribute("disabled",!0),a.toggleAttribute("aria-hidden",!0),a.toggleAttribute("hidden",!0),a.toggleAttribute("inert",!0),a.querySelectorAll("a").forEach((e=>e.setAttribute("tabindex",-1))),t.classList.remove("searching"),t.dataset.nrresults="0",html(s,context.labels[lang].nrtrovati(0,0)),n.value="",context.search?.[context.state.lang]&&(context.search[context.state.lang].instance.unmark(),context.search[context.state.lang].results=[],context.search[context.state.lang].cursor=0),e.classList.remove("searchActive")},search=function(e){const t=context.search?.[context.state.lang];if(!t)return!1;const n=context.elementsCache.sectionsMenu.querySelector(`search[lang='${context.state.lang}']`),a=n.querySelector("label");if(n.classList.add("searching"),resetHash(),!e)return t.instance.unmark(),t.results=[],t.cursor=0,n.dataset.nrresults="0",html(a,context.labels[lang].nrtrovati(0,0)),n.classList.remove("searching"),!1;const s={separateWordSearch:!0,diacritics:!0,caseSensitive:!1,ignoreJoiners:!0,wildcards:"enabled",done:()=>{t.results=context.elementsCache.scrollingContainer.querySelectorAll(`section[data-sezione][lang="${context.state.lang}"] mark`),t.cursor=0,n.dataset.nrresults=t.results.length,n.classList.remove("searching"),setActiveResult()}};t.instance.unmark({done:()=>{t.instance.mark(e,s)}})},goToResult=function(e){const t=context.state.lang,n=context.search[t];if(n.results.length<1)return!1;const a=e&&"prev"===e?0===n.cursor?n.results.length-1:n.cursor-1:n.cursor===n.results.length-1?0:n.cursor+1;executeWhenNotScrolling((()=>setActiveResult(a)))},setActiveResult=function(e){const t=context.state.lang,n=context.elementsCache.scrollingContainer,a=document.querySelector(`search[lang="${t}"]`),s=context.search[t],o=e||0,i=document.querySelector(`search[lang="${t}"]`).querySelector("label");if(s.results.length<1||o>s.results.length-1)return html(i,context.labels[t].nrtrovati(0,0)),!1;a.classList.add("searching");let r="nearest";const c=s.results.item(s.cursor),l=s.results.item(o),d=l.closest("details"),u=l.closest("figure"),g=l.closest(".slide");c.classList.remove("active"),l.classList.add("active"),s.cursor=o,html(i,context.labels[t].nrtrovati(s.results.length,o+1)),n.addEventListener("sectionActivated",(()=>{if(d&&!d.getAttribute("open")&&d.toggleAttribute("open",!0),u){u.closest("li").focus(),r="start"}softExec((()=>l.scrollIntoView({behavior:"smooth",block:r,inline:"nearest"}))),a.classList.remove("searching")}),{once:!0}),executeWhenNotScrolling((()=>setActiveSection(g.dataset.sezione)))},executeWhenNotScrolling=function(e){context.elementsCache.scrollingContainer.classList.contains("scrolling")?context.elementsCache.scrollingContainer.addEventListener("scrollStop",(()=>softExec(e)),{once:!0}):softExec(e)},executeWhenNotAnimating=function(e,t){Promise.all(e.getAnimations({subtree:!0}).map((e=>e.finished))).then((()=>softExec(t)))},setDraggableList=async function(e,t){const n=e=>{(e=>e.target.classList.contains("drag-item")?e.target:e.target.closest(".drag-item"))(e)&&e.stopPropagation()};e.addEventListener("mousedown",n,{passive:!1}),e.addEventListener("mouseup",n,{passive:!1}),e.addEventListener("mousemove",n,{passive:!1});const{setDraggable:a}=await import(config.urls.libs.draggablelistjs);softExec((()=>{a(e),e.previousSibling.innerHTML=context.labels[t].sceglisezioni}))},setCV=function(e){hasTouch()||setDraggableList(e.querySelector("ul"),e.getAttribute("lang")),e.addEventListener("change",(e=>{const t=e.target;if(!t.dataset||!t.dataset.rel||"cv"!==t.dataset.rel)return!0;const n=t.closest("li");if(n.classList.contains("drag-item"))n.querySelectorAll("ul [type='checkbox']").forEach((e=>{e.checked=t.checked}));else{const e=n.closest("li.drag-item"),t=e.querySelector("[type='checkbox']"),a=e.querySelector("ul").querySelectorAll("[type='checkbox']:checked").length;t.checked=t.disabled||a>0}}))},downloadCV=async function(){const e=context.elementsCache.scrollingContainer.querySelector(`section[data-sezione='cv'][lang='${context.state.lang}']`);e.classList.add("loading");const{buildPDF:t}=await import(config.urls.modules.cv);Promise.allSettled([fetchResource(config.urls.libs.dompurify,"js","domPurify"),fetchResource(config.urls.libs.jspdf,"js","jsPDF"),loadAllDynaContent(context.state.lang)]).then((()=>{t(context.state.lang).then((()=>notify(context.labels[context.state.lang].downloadStarted,"success"))).catch((()=>notify(context.labels[context.state.lang].error,"error"))).finally((()=>e.classList.remove("loading")))})).catch((()=>{notify(context.labels[context.state.lang].error,"error"),e.classList.remove("loading")}))},sendMsg=async function(e){if(!e)return!1;if(self.navigator.onLine){const t=context.elementsCache.scrollingContainer.querySelector(`section[data-sezione='contattami'][lang='${context.state.lang}']`);t.classList.add("loading");const{sendMessage:n}=await import(config.urls.modules.contactme);n(e).then((()=>{notify(context.labels[context.state.lang].messageSent,"success"),e.reset()})).catch((e=>{notify(context.labels[context.state.lang].error,"error")})).finally((()=>{t.classList.remove("loading")}))}else notify(context.labels[context.state.lang].offlineTryLater,"warning")},notify=(e,t)=>{const n=document.querySelector("ui-notifications");n?n.add(e,t):import(config.urls.libs.notificationsjs).then((()=>{document.querySelector("ui-notifications")||document.body.insertAdjacentHTML("beforeend",'<ui-notifications role="alert" aria-live="assertive" aria-atomic="true" aria-relevant="additions"></ui-notifications>'),document.querySelector("ui-notifications").add(e,t)}))},toggleMaximizeSlide=(e,t)=>{if(!e)return!1;const n=()=>{e.classList.toggle("expanded",!0);const n=e.querySelector(".chkMaximize");n.checked=t,n.setAttribute("aria-expanded",t),e.classList.toggle("maximized",t)};document.startViewTransition?document.startViewTransition(n):n(),t?window.history.pushState({maximizedSlide:!0},context.dynaContent.slides[context.state.lang][e.dataset.sezione].title):window.history.back()};setup();